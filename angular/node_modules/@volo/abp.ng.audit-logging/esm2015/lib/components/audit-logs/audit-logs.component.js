import{__decorate}from"tslib";import{ListService}from"@abp/ng.core";import{collapse,fadeIn}from"@abp/ng.theme.shared";import{EXTENSIONS_IDENTIFIER}from"@abp/ng.theme.shared/extensions";import{transition,trigger,useAnimation}from"@angular/animations";import{Component}from"@angular/core";import{Select,Store}from"@ngxs/store";import{take}from"rxjs/operators";import{GetAuditLogs}from"../../actions/audit-logging.actions";import{HTTP_METHODS,HTTP_STATUS_CODES}from"../../constants/http";import{AuditLogsService}from"../../proxy/audit-logging/audit-logs.service";import{AuditLoggingState}from"../../states/audit-logging.state";const ɵ0="AuditLogging.AuditLogsComponent";export class AuditLogsComponent{constructor(n,r,o){this.list=n,this.service=r,this.store=o,this.selected={},this.pageQuery={maxResultCount:10,skipCount:0},this.httpMethods=HTTP_METHODS,this.httpStatusCodes=HTTP_STATUS_CODES,this.modalVisible=!1,this.collapseActionStates=[!0],this.collapseChangeStates=[!0],this.sortOrder="",this.sortKey="",this.selectedTab="audit-logs"}ngOnInit(){this.hookToQuery()}hookToQuery(){this.list.hookToQuery(n=>this.store.dispatch(new GetAuditLogs(Object.assign(Object.assign(Object.assign(Object.assign({},this.pageQuery),null===this.pageQuery.minExecutionDuration&&{minExecutionDuration:void 0}),null===this.pageQuery.maxExecutionDuration&&{maxExecutionDuration:void 0}),n)))).subscribe()}openModal(n){this.service.get(n).pipe(take(1)).subscribe(n=>{this.selected=n,this.modalVisible=!0})}httpCodeClass(n){switch(n.toString()[0]){case"2":return"badge-success";case"3":return"badge-warning";case"4":case"5":return"badge-danger";default:return"badge-light"}}httpMethodClass(n){switch(n){case"GET":return"badge-dark";case"POST":return"badge-success";case"DELETE":return"badge-danger";case"PUT":return"badge-warning";default:return""}}}AuditLogsComponent.decorators=[{type:Component,args:[{selector:"abp-audit-logs",template:'<ng-container *ngIf="datas$ | async as data">\r\n  <div id="wrapper">\r\n    <div class="row entry-row">\r\n      <div class="col-auto">\r\n        <h1 class="content-header-title">{{ \'AbpAuditLogging::AuditLogs\' | abpLocalization }}</h1>\r\n      </div>\r\n      <div class="col-lg-auto pl-lg-0">\r\n        <abp-breadcrumb></abp-breadcrumb>\r\n      </div>\r\n      <div class="col">\r\n        <abp-page-toolbar [record]="data"></abp-page-toolbar>\r\n      </div>\r\n    </div>\r\n    <ul class="nav nav-tabs">\r\n      <li class="nav-item">\r\n        <a\r\n          class="nav-link pointer"\r\n          [class.active]="selectedTab === \'audit-logs\'"\r\n          (click)="selectedTab = \'audit-logs\'"\r\n          >{{ \'AbpAuditLogging::AuditLogs\' | abpLocalization }}</a\r\n        >\r\n      </li>\r\n      <li class="nav-item">\r\n        <a\r\n          class="nav-link pointer"\r\n          [class.active]="selectedTab === \'entity-changes\'"\r\n          (click)="selectedTab = \'entity-changes\'"\r\n          >{{ \'AbpAuditLogging::EntityChanges\' | abpLocalization }}</a\r\n        >\r\n      </li>\r\n    </ul>\r\n    <div class="tab-content" [class.p-0]="selectedTab !== \'audit-logs\'">\r\n      <div class="tab-pane" [class.active]="selectedTab === \'audit-logs\'" [@fadeIn]="selectedTab">\r\n        <div class="card">\r\n          <div class="card-body pb-lg-3">\r\n            <form (keyup.enter)="list.get()">\r\n              <div class="row">\r\n                <div class="col-md-6 col-lg-2">\r\n                  <div class="form-group">\r\n                    <label for="userName">{{ \'AbpAuditLogging::UserName\' | abpLocalization }}</label\r\n                    ><input\r\n                      id="userName"\r\n                      type="text"\r\n                      class="form-control"\r\n                      [(ngModel)]="pageQuery.userName"\r\n                      [ngModelOptions]="{ standalone: true }"\r\n                    />\r\n                  </div>\r\n                </div>\r\n                <div class="col-md-6 col-lg-2">\r\n                  <div class="form-group">\r\n                    <label for="url">{{ \'AbpAuditLogging::UrlFilter\' | abpLocalization }}</label\r\n                    ><input\r\n                      id="url"\r\n                      type="text"\r\n                      class="form-control"\r\n                      [(ngModel)]="pageQuery.url"\r\n                      [ngModelOptions]="{ standalone: true }"\r\n                    />\r\n                  </div>\r\n                </div>\r\n                <div class="col-md-6 col-lg-2">\r\n                  <div class="form-group">\r\n                    <label for="minDuration">{{\r\n                      \'AbpAuditLogging::MinDuration\' | abpLocalization\r\n                    }}</label\r\n                    ><input\r\n                      id="minDuration"\r\n                      type="number"\r\n                      class="form-control"\r\n                      [(ngModel)]="pageQuery.minExecutionDuration"\r\n                      [ngModelOptions]="{ standalone: true }"\r\n                    />\r\n                  </div>\r\n                </div>\r\n                <div class="col-md-6 col-lg-2">\r\n                  <div class="form-group">\r\n                    <label for="maxDuration">{{\r\n                      \'AbpAuditLogging::MaxDuration\' | abpLocalization\r\n                    }}</label\r\n                    ><input\r\n                      id="maxDuration"\r\n                      type="number"\r\n                      class="form-control"\r\n                      [(ngModel)]="pageQuery.maxExecutionDuration"\r\n                      [ngModelOptions]="{ standalone: true }"\r\n                    />\r\n                  </div>\r\n                </div>\r\n                <div class="col-md-6 col-lg-2">\r\n                  <div class="form-group">\r\n                    <label for="httpMethod">{{\r\n                      \'AbpAuditLogging::HttpMethod\' | abpLocalization\r\n                    }}</label\r\n                    ><select\r\n                      id="httpMethod"\r\n                      class="custom-select form-control"\r\n                      [(ngModel)]="pageQuery.httpMethod"\r\n                      [ngModelOptions]="{ standalone: true }"\r\n                      (change)="list.get()"\r\n                    >\r\n                      <option [ngValue]=""></option>\r\n                      <option *ngFor="let method of httpMethods" [ngValue]="method">\r\n                        {{ method }}\r\n                      </option>\r\n                    </select>\r\n                  </div>\r\n                </div>\r\n                <div class="col-md-6 col-lg-2">\r\n                  <div class="form-group">\r\n                    <label for="httpStatusCode">{{\r\n                      \'AbpAuditLogging::HttpStatusCode\' | abpLocalization\r\n                    }}</label\r\n                    ><select\r\n                      id="httpStatusCode"\r\n                      class="custom-select form-control"\r\n                      [(ngModel)]="pageQuery.httpStatusCode"\r\n                      [ngModelOptions]="{ standalone: true }"\r\n                      (change)="list.get()"\r\n                    >\r\n                      <option [ngValue]=""></option>\r\n                      <option *ngFor="let h of httpStatusCodes" [ngValue]="h.code">\r\n                        {{ h.code }} - {{ h.message }}\r\n                      </option>\r\n                    </select>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n              <div class="row">\r\n                <div class="col-md-6 col-lg-3">\r\n                  <div class="form-group mb-lg-0">\r\n                    <label for="applicationName">{{\r\n                      \'AbpAuditLogging::ApplicationName\' | abpLocalization\r\n                    }}</label\r\n                    ><input\r\n                      id="applicationName"\r\n                      type="text"\r\n                      class="form-control"\r\n                      [(ngModel)]="pageQuery.applicationName"\r\n                      [ngModelOptions]="{ standalone: true }"\r\n                    />\r\n                  </div>\r\n                </div>\r\n                <div class="col-md-6 col-lg-3">\r\n                  <div class="form-group mb-lg-0">\r\n                    <label for="correlationId">{{\r\n                      \'AbpAuditLogging::CorrelationId\' | abpLocalization\r\n                    }}</label\r\n                    ><input\r\n                      id="correlationId"\r\n                      type="text"\r\n                      class="form-control"\r\n                      [(ngModel)]="pageQuery.correlationId"\r\n                      [ngModelOptions]="{ standalone: true }"\r\n                    />\r\n                  </div>\r\n                </div>\r\n                <div class="col-md-6 col-lg-3">\r\n                  <div class="form-group mb-lg-0">\r\n                    <label for="hasException">{{\r\n                      \'AbpAuditLogging::HasException\' | abpLocalization\r\n                    }}</label>\r\n                    <select\r\n                      name="hasException"\r\n                      id="hasException"\r\n                      class="custom-select form-control"\r\n                      [(ngModel)]="pageQuery.hasException"\r\n                      [ngModelOptions]="{ standalone: true }"\r\n                      (change)="list.get()"\r\n                    >\r\n                      <option [ngValue]=""></option>\r\n                      <option [ngValue]="true">\r\n                        {{ \'AbpAuditLogging::Yes\' | abpLocalization }}\r\n                      </option>\r\n                      <option [ngValue]="false">\r\n                        {{ \'AbpAuditLogging::No\' | abpLocalization }}\r\n                      </option>\r\n                    </select>\r\n                  </div>\r\n                </div>\r\n                <div class="col-md-6 col-lg-3">\r\n                  <button\r\n                    type="button"\r\n                    class="btn btn-primary btn-block mt-0 mt-md-4"\r\n                    (click)="list.get()"\r\n                  >\r\n                    <span>\r\n                      {{ \'AbpAuditLogging::Refresh\' | abpLocalization }}\r\n                    </span>\r\n                  </button>\r\n                </div>\r\n              </div>\r\n            </form>\r\n          </div>\r\n        </div>\r\n        <div class="card">\r\n          <div class="card-body p-0">\r\n            <abp-extensible-table\r\n              [data]="data"\r\n              [recordsTotal]="totalCount$ | async"\r\n              [list]="list"\r\n            ></abp-extensible-table>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n    <div class="tab-content" [class.p-0]="selectedTab !== \'entity-changes\'">\r\n      <div\r\n        class="tab-pane"\r\n        [class.active]="selectedTab === \'entity-changes\'"\r\n        [@fadeIn]="selectedTab"\r\n      >\r\n        <abp-entity-changes *ngIf="selectedTab === \'entity-changes\'"></abp-entity-changes>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</ng-container>\r\n\r\n<abp-modal *ngIf="selected" [(visible)]="modalVisible">\r\n  <ng-template #abpHeader>\r\n    <h5 class="modal-title">\r\n      {{ \'AbpAuditLogging::Detail\' | abpLocalization }}\r\n    </h5>\r\n  </ng-template>\r\n  <ng-template #abpBody>\r\n    <ul ngbNav #nav="ngbNav" class="nav-tabs">\r\n      <li ngbNavItem>\r\n        <a ngbNavLink>{{ \'AbpAuditLogging::Overall\' | abpLocalization }}</a>\r\n        <ng-template ngbNavContent>\r\n          <div class="row">\r\n            <div class="col-form-label col col-lg-3">\r\n              <strong>{{ \'AbpAuditLogging::HttpStatusCode\' | abpLocalization }}</strong>\r\n            </div>\r\n            <div class="col-form-label col col-lg-9">\r\n              <span class="badge" [ngClass]="httpCodeClass(selected.httpStatusCode)">{{\r\n                selected.httpStatusCode\r\n              }}</span>\r\n            </div>\r\n          </div>\r\n          <hr />\r\n          <div class="row">\r\n            <div class="col-form-label col col-lg-3">\r\n              <strong>{{ \'AbpAuditLogging::HttpMethod\' | abpLocalization }}</strong>\r\n            </div>\r\n            <div class="col-form-label col col-lg-9">\r\n              <span class="badge" [ngClass]="httpMethodClass(selected.httpMethod)">{{\r\n                selected.httpMethod\r\n              }}</span>\r\n            </div>\r\n          </div>\r\n          <hr />\r\n          <div class="row">\r\n            <div class="col-form-label col col-lg-3">\r\n              <strong>{{ \'AbpAuditLogging::Url\' | abpLocalization }}</strong>\r\n            </div>\r\n            <div class="col-form-label col col-lg-9">{{ selected.url }}</div>\r\n          </div>\r\n          <hr />\r\n          <div class="row">\r\n            <div class="col-form-label col col-lg-3">\r\n              <strong>{{ \'AbpAuditLogging::ClientIpAddress\' | abpLocalization }}</strong>\r\n            </div>\r\n            <div class="col-form-label col col-lg-9">{{ selected.clientIpAddress }}</div>\r\n          </div>\r\n          <hr />\r\n          <div class="row">\r\n            <div class="col-form-label col col-lg-3">\r\n              <strong>{{ \'AbpAuditLogging::ClientName\' | abpLocalization }}</strong>\r\n            </div>\r\n            <div class="col-form-label col col-lg-9">{{ selected.clientName }}</div>\r\n          </div>\r\n          <hr />\r\n          <div class="row">\r\n            <div class="col-form-label col col-lg-3">\r\n              <strong>{{ \'AbpAuditLogging::Exceptions\' | abpLocalization }}</strong>\r\n            </div>\r\n            <div class="col-form-label col col-lg-9">\r\n              <pre lang="c-sharp">\r\n                {{ selected.exceptions }}\r\n              </pre>\r\n            </div>\r\n          </div>\r\n          <hr />\r\n          <div class="row">\r\n            <div class="col-form-label col col-lg-3">\r\n              <strong>{{ \'AbpAuditLogging::UserName\' | abpLocalization }}</strong>\r\n            </div>\r\n            <div class="col-form-label col col-lg-9">{{ selected.userName }}</div>\r\n          </div>\r\n          <hr />\r\n          <div class="row">\r\n            <div class="col-form-label col col-lg-3">\r\n              <strong>{{ \'AbpAuditLogging::Time\' | abpLocalization }}</strong>\r\n            </div>\r\n            <div class="col-form-label col col-lg-9">{{ selected.executionTime }}</div>\r\n          </div>\r\n          <hr />\r\n          <div class="row">\r\n            <div class="col-form-label col col-lg-3">\r\n              <strong>{{ \'AbpAuditLogging::Duration\' | abpLocalization }}</strong>\r\n            </div>\r\n            <div class="col-form-label col col-lg-9">{{ selected.executionDuration }}</div>\r\n          </div>\r\n          <hr />\r\n          <div class="row">\r\n            <div class="col-form-label col col-lg-3">\r\n              <strong>{{ \'AbpAuditLogging::BrowserInfo\' | abpLocalization }}</strong>\r\n            </div>\r\n            <div class="col-form-label col col-lg-9">{{ selected.browserInfo }}</div>\r\n          </div>\r\n          <hr />\r\n          <div class="row">\r\n            <div class="col-form-label col col-lg-3">\r\n              <strong>{{ \'AbpAuditLogging::ApplicationName\' | abpLocalization }}</strong>\r\n            </div>\r\n            <div class="col-form-label col col-lg-9">{{ selected.applicationName }}</div>\r\n          </div>\r\n          <hr />\r\n          <div class="row">\r\n            <div class="col-form-label col col-lg-3">\r\n              <strong>{{ \'AbpAuditLogging::CorrelationId\' | abpLocalization }}</strong>\r\n            </div>\r\n            <div class="col-form-label col col-lg-9">{{ selected.correlationId }}</div>\r\n          </div>\r\n          <hr />\r\n          <div class="row">\r\n            <div class="col-form-label col col-lg-3">\r\n              <strong>{{ \'AbpAuditLogging::Comments\' | abpLocalization }}</strong>\r\n            </div>\r\n            <div class="col-form-label col col-lg-9">{{ selected.comments }}</div>\r\n          </div>\r\n          <hr />\r\n          <div class="row">\r\n            <div class="col-form-label col col-lg-3">\r\n              <strong>{{ \'AbpAuditLogging::ExtraProperties\' | abpLocalization }}</strong>\r\n            </div>\r\n            <div class="col-form-label col col-lg-9">\r\n              <pre lang="json" class="p-2">\r\n                {{ selected.extraProperties | json }}\r\n              </pre>\r\n            </div>\r\n          </div>\r\n        </ng-template>\r\n      </li>\r\n      <li ngbNavItem>\r\n        <a ngbNavLink\r\n          >{{ \'AbpAuditLogging::Actions\' | abpLocalization }} ({{ selected.actions.length }})</a\r\n        >\r\n        <ng-template ngbNavContent>\r\n          <div\r\n            class="mb-3 border border-dark rounded"\r\n            *ngFor="let action of selected.actions; let i = index"\r\n          >\r\n            <button\r\n              class="btn btn-primary btn-block"\r\n              type="button"\r\n              (click)="collapseActionStates[i] = !collapseActionStates[i]"\r\n            >\r\n              {{ action.serviceName }}\r\n            </button>\r\n            <div [@collapse]="collapseActionStates[i] ? \'expanded\' : \'collapsed\'">\r\n              <div class="m-3">\r\n                <div class="row">\r\n                  <div class="col-form-label col col-lg-3">\r\n                    <strong>{{ \'AbpAuditLogging::Duration\' | abpLocalization }}</strong>\r\n                  </div>\r\n                  <div class="col-form-label col col-lg-9">\r\n                    {{ action.executionDuration ? action.executionDuration + \' ms\' : \'\' }}\r\n                  </div>\r\n                </div>\r\n                <hr />\r\n                <div class="row">\r\n                  <div class="col-form-label col col-lg-3">\r\n                    <strong>{{ \'AbpAuditLogging::Parameters\' | abpLocalization }}</strong>\r\n                  </div>\r\n                  <div class="col-form-label col col-lg-9">\r\n                    <pre lang="json" class="p-2">{{ action.parameters }}</pre>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </ng-template>\r\n      </li>\r\n    </ul>\r\n    <div [ngbNavOutlet]="nav"></div>\r\n  </ng-template>\r\n  <ng-template #abpFooter>\r\n    <button class="btn btn-secondary" #abpClose>\r\n      {{ \'AbpAuditLogging::Close\' | abpLocalization }}\r\n    </button>\r\n  </ng-template>\r\n</abp-modal>\r\n',animations:[collapse,trigger("fadeIn",[transition("* <=> *",useAnimation(fadeIn))])],providers:[ListService,{provide:EXTENSIONS_IDENTIFIER,useValue:ɵ0}]}]}],AuditLogsComponent.ctorParameters=()=>[{type:ListService},{type:AuditLogsService},{type:Store}],__decorate([Select(AuditLoggingState.get)],AuditLogsComponent.prototype,"datas$",void 0),__decorate([Select(AuditLoggingState.getTotalCount)],AuditLogsComponent.prototype,"totalCount$",void 0);export{ɵ0};