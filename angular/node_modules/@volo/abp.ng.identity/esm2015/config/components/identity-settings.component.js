import{ApplicationConfigurationService,ConfigStateService,SubscriptionService}from"@abp/ng.core";import{ToasterService}from"@abp/ng.theme.shared";import{Component}from"@angular/core";import{FormBuilder,Validators}from"@angular/forms";import{Store}from"@ngxs/store";import{filter,finalize}from"rxjs/operators";import snq from"snq";import{IdentityConfigService}from"../services/identity-config.service";const{required:required,max:max,min:min}=Validators;export class IdentitySettingsComponent{constructor(e,r,n,t,i,o,a){this.identityConfigService=e,this.toaster=r,this.fb=n,this.store=t,this.subscription=i,this.configState=o,this.appConfigService=a,this.settings={},this.doNotRequireConfirmedPhoneNumber=()=>{this.form.get("signIn.requireConfirmedPhoneNumber").setValue(!1)},this.enablePhoneNumberConfirmation=()=>{this.form.get("signIn.enablePhoneNumberConfirmation").setValue(!0)},e.getSettings().subscribe(e=>{this.settings=e,this.buildForm(),this.syncConfirmationOptions()})}get initialized(){return"{}"!==JSON.stringify(this.settings)}buildForm(){const e=snq(()=>this.settings.password,{}),r=this.fb.group({requiredLength:[e.requiredLength,[required,max(32),min(2)]],requiredUniqueChars:[e.requiredUniqueChars,[required,max(32),min(1)]],requireNonAlphanumeric:e.requireNonAlphanumeric,requireLowercase:e.requireLowercase,requireUppercase:e.requireUppercase,requireDigit:e.requireDigit}),n=snq(()=>this.settings.lockout,{}),t=this.fb.group({allowedForNewUsers:n.allowedForNewUsers,lockoutDuration:[n.lockoutDuration,[required]],maxFailedAccessAttempts:[n.maxFailedAccessAttempts,[required]]}),i=snq(()=>this.settings.signIn,{}),o=this.fb.group({requireConfirmedEmail:i.requireConfirmedEmail,enablePhoneNumberConfirmation:i.enablePhoneNumberConfirmation,requireConfirmedPhoneNumber:i.requireConfirmedPhoneNumber}),a=snq(()=>this.settings.user,{}),s=this.fb.group({isUserNameUpdateEnabled:a.isUserNameUpdateEnabled,isEmailUpdateEnabled:a.isEmailUpdateEnabled});this.form=this.fb.group({password:r,lockout:t,signIn:o,user:s})}syncConfirmationOptions(){this.subscription.addOne(this.form.get("signIn.requireConfirmedPhoneNumber").valueChanges.pipe(filter(Boolean)),this.enablePhoneNumberConfirmation),this.subscription.addOne(this.form.get("signIn.enablePhoneNumberConfirmation").valueChanges.pipe(filter(e=>!e)),this.doNotRequireConfirmedPhoneNumber)}submit(){this.loading=!0,this.identityConfigService.updateSettings(this.form.value).pipe(finalize(()=>{this.loading=!1,this.appConfigService.getConfiguration().subscribe(e=>this.configState.setState(e))})).subscribe(()=>this.toaster.success("AbpIdentity::SavedSuccessfully",null))}}IdentitySettingsComponent.decorators=[{type:Component,args:[{selector:"abp-identity-settings",template:'<h2>{{ \'AbpIdentity::Menu:IdentityManagement\' | abpLocalization }}</h2>\r\n<hr class="my-4" />\r\n<form\r\n  *ngIf="form"\r\n  id="IdentitySettingsForm"\r\n  [formGroup]="form"\r\n  (ngSubmit)="submit()"\r\n  validateOnSubmit\r\n>\r\n  <div class="row">\r\n    <div class="col-md-12">\r\n      <div formGroupName="password">\r\n        <h4>{{ \'AbpIdentity::PasswordSettings\' | abpLocalization }}</h4>\r\n        <div class="form-group">\r\n          <label for="Password_RequiredLength">{{\r\n            \'AbpIdentity::DisplayName:Abp.Identity.Password.RequiredLength\' | abpLocalization\r\n          }}</label\r\n          ><input\r\n            type="number"\r\n            id="Password_RequiredLength"\r\n            name="Password.RequiredLength"\r\n            class="form-control"\r\n            formControlName="requiredLength"\r\n            min="2"\r\n            max="32"\r\n          />\r\n          <small class="form-text text-muted">{{\r\n            \'AbpIdentity::Description:Abp.Identity.Password.RequiredLength\' | abpLocalization\r\n          }}</small>\r\n        </div>\r\n        <div class="form-group">\r\n          <label for="Password_RequiredUniqueChars">{{\r\n            \'AbpIdentity::DisplayName:Abp.Identity.Password.RequiredUniqueChars\' | abpLocalization\r\n          }}</label\r\n          ><input\r\n            type="number"\r\n            id="Password_RequiredUniqueChars"\r\n            name="Password.RequiredUniqueChars"\r\n            class="form-control"\r\n            formControlName="requiredUniqueChars"\r\n            min="0"\r\n            max="32"\r\n          />\r\n          <small class="form-text text-muted">{{\r\n            \'AbpIdentity::Description:Abp.Identity.Password.RequiredUniqueChars\' | abpLocalization\r\n          }}</small>\r\n        </div>\r\n        <div class="custom-checkbox custom-control mb-2">\r\n          <input\r\n            type="checkbox"\r\n            id="Password_RequireNonAlphanumeric"\r\n            name="Password.RequireNonAlphanumeric"\r\n            class="custom-control-input "\r\n            formControlName="requireNonAlphanumeric"\r\n          /><label class="custom-control-label" for="Password_RequireNonAlphanumeric">{{\r\n            \'AbpIdentity::DisplayName:Abp.Identity.Password.RequireNonAlphanumeric\'\r\n              | abpLocalization\r\n          }}</label>\r\n          <small class="form-text text-muted">{{\r\n            \'AbpIdentity::Description:Abp.Identity.Password.RequireNonAlphanumeric\'\r\n              | abpLocalization\r\n          }}</small>\r\n        </div>\r\n        <div class="custom-checkbox custom-control mb-2">\r\n          <input\r\n            type="checkbox"\r\n            id="Password_RequireLowercase"\r\n            name="Password.RequireLowercase"\r\n            class="custom-control-input "\r\n            formControlName="requireLowercase"\r\n          /><label class="custom-control-label" for="Password_RequireLowercase">{{\r\n            \'AbpIdentity::DisplayName:Abp.Identity.Password.RequireLowercase\' | abpLocalization\r\n          }}</label>\r\n          <small class="form-text text-muted">{{\r\n            \'AbpIdentity::Description:Abp.Identity.Password.RequireLowercase\' | abpLocalization\r\n          }}</small>\r\n        </div>\r\n        <div class="custom-checkbox custom-control mb-2">\r\n          <input\r\n            type="checkbox"\r\n            id="Password_RequireUppercase"\r\n            name="Password.RequireUppercase"\r\n            class="custom-control-input "\r\n            formControlName="requireUppercase"\r\n          /><label class="custom-control-label" for="Password_RequireUppercase">{{\r\n            \'AbpIdentity::DisplayName:Abp.Identity.Password.RequireUppercase\' | abpLocalization\r\n          }}</label>\r\n          <small class="form-text text-muted">{{\r\n            \'AbpIdentity::Description:Abp.Identity.Password.RequireUppercase\' | abpLocalization\r\n          }}</small>\r\n        </div>\r\n        <div class="custom-checkbox custom-control mb-2">\r\n          <input\r\n            type="checkbox"\r\n            id="Password_RequireDigit"\r\n            name="Password.RequireDigit"\r\n            class="custom-control-input "\r\n            formControlName="requireDigit"\r\n          /><label class="custom-control-label" for="Password_RequireDigit">{{\r\n            \'AbpIdentity::DisplayName:Abp.Identity.Password.RequireDigit\' | abpLocalization\r\n          }}</label>\r\n          <small class="form-text text-muted">{{\r\n            \'AbpIdentity::Description:Abp.Identity.Password.RequireDigit\' | abpLocalization\r\n          }}</small>\r\n        </div>\r\n      </div>\r\n      <hr class="my-4" />\r\n      <div formGroupName="lockout">\r\n        <h4>{{ \'AbpIdentity::LockoutSettings\' | abpLocalization }}</h4>\r\n        <div class="custom-checkbox custom-control mb-2">\r\n          <input\r\n            type="checkbox"\r\n            id="Lockout_AllowedForNewUsers"\r\n            name="Lockout.AllowedForNewUsers"\r\n            class="custom-control-input "\r\n            formControlName="allowedForNewUsers"\r\n          /><label class="custom-control-label" for="Lockout_AllowedForNewUsers">{{\r\n            \'AbpIdentity::DisplayName:Abp.Identity.Lockout.AllowedForNewUsers\' | abpLocalization\r\n          }}</label>\r\n          <small class="form-text text-muted">{{\r\n            \'AbpIdentity::Description:Abp.Identity.Lockout.AllowedForNewUsers\' | abpLocalization\r\n          }}</small>\r\n        </div>\r\n        <div class="form-group">\r\n          <label for="Lockout_LockoutDuration">{{\r\n            \'AbpIdentity::DisplayName:Abp.Identity.Lockout.LockoutDuration\' | abpLocalization\r\n          }}</label\r\n          ><input\r\n            type="number"\r\n            id="Lockout_LockoutDuration"\r\n            name="Lockout.LockoutDuration"\r\n            class="form-control"\r\n            formControlName="lockoutDuration"\r\n          />\r\n          <small class="form-text text-muted">{{\r\n            \'AbpIdentity::Description:Abp.Identity.Lockout.LockoutDuration\' | abpLocalization\r\n          }}</small>\r\n        </div>\r\n        <div class="form-group">\r\n          <label for="Lockout_MaxFailedAccessAttempts">{{\r\n            \'AbpIdentity::DisplayName:Abp.Identity.Lockout.MaxFailedAccessAttempts\'\r\n              | abpLocalization\r\n          }}</label\r\n          ><input\r\n            type="number"\r\n            id="Lockout_MaxFailedAccessAttempts"\r\n            name="Lockout.MaxFailedAccessAttempts"\r\n            class="form-control"\r\n            formControlName="maxFailedAccessAttempts"\r\n          />\r\n          <small class="form-text text-muted">{{\r\n            \'AbpIdentity::Description:Abp.Identity.Lockout.MaxFailedAccessAttempts\'\r\n              | abpLocalization\r\n          }}</small>\r\n        </div>\r\n      </div>\r\n      <hr class="my-4" />\r\n      <div formGroupName="signIn">\r\n        <h4>{{ \'AbpIdentity::SignInSettings\' | abpLocalization }}</h4>\r\n        <div class="custom-checkbox custom-control mb-2">\r\n          <input\r\n            type="checkbox"\r\n            id="SignIn_RequireConfirmedEmail"\r\n            name="SignIn.RequireConfirmedEmail"\r\n            class="custom-control-input "\r\n            formControlName="requireConfirmedEmail"\r\n          /><label class="custom-control-label" for="SignIn_RequireConfirmedEmail">{{\r\n            \'AbpIdentity::DisplayName:Abp.Identity.SignIn.RequireConfirmedEmail\' | abpLocalization\r\n          }}</label>\r\n          <small class="form-text text-muted">{{\r\n            \'AbpIdentity::Description:Abp.Identity.SignIn.RequireConfirmedEmail\' | abpLocalization\r\n          }}</small>\r\n        </div>\r\n        <div class="custom-checkbox custom-control mb-2">\r\n          <input\r\n            type="checkbox"\r\n            id="SignIn_EnablePhoneNumberConfirmation"\r\n            name="SignIn.EnablePhoneNumberConfirmation"\r\n            class="custom-control-input "\r\n            formControlName="enablePhoneNumberConfirmation"\r\n          /><label class="custom-control-label" for="SignIn_EnablePhoneNumberConfirmation">{{\r\n            \'AbpIdentity::DisplayName:Abp.Identity.SignIn.EnablePhoneNumberConfirmation\'\r\n              | abpLocalization\r\n          }}</label>\r\n          <small class="form-text text-muted">{{\r\n            \'AbpIdentity::Description:Abp.Identity.SignIn.EnablePhoneNumberConfirmation\'\r\n              | abpLocalization\r\n          }}</small>\r\n        </div>\r\n        <div class="custom-checkbox custom-control mb-2">\r\n          <input\r\n            type="checkbox"\r\n            id="SignIn_RequireConfirmedPhoneNumber"\r\n            name="SignIn.RequireConfirmedPhoneNumber"\r\n            class="custom-control-input "\r\n            formControlName="requireConfirmedPhoneNumber"\r\n          /><label class="custom-control-label" for="SignIn_RequireConfirmedPhoneNumber">{{\r\n            \'AbpIdentity::DisplayName:Abp.Identity.SignIn.RequireConfirmedPhoneNumber\'\r\n              | abpLocalization\r\n          }}</label>\r\n          <small class="form-text text-muted">{{\r\n            \'AbpIdentity::Description:Abp.Identity.SignIn.RequireConfirmedPhoneNumber\'\r\n              | abpLocalization\r\n          }}</small>\r\n        </div>\r\n      </div>\r\n      <hr class="my-4" />\r\n      <div formGroupName="user">\r\n        <h4>{{ \'AbpIdentity::UserSettings\' | abpLocalization }}</h4>\r\n        <div class="custom-checkbox custom-control mb-2">\r\n          <input\r\n            type="checkbox"\r\n            id="User_IsEmailUpdateEnabled"\r\n            name="User.IsEmailUpdateEnabled"\r\n            class="custom-control-input "\r\n            formControlName="isEmailUpdateEnabled"\r\n          /><label class="custom-control-label" for="User_IsEmailUpdateEnabled">{{\r\n            \'AbpIdentity::DisplayName:Abp.Identity.User.IsEmailUpdateEnabled\' | abpLocalization\r\n          }}</label>\r\n          <small class="form-text text-muted">{{\r\n            \'AbpIdentity::Description:Abp.Identity.User.IsEmailUpdateEnabled\' | abpLocalization\r\n          }}</small>\r\n        </div>\r\n        <div class="custom-checkbox custom-control mb-2">\r\n          <input\r\n            type="checkbox"\r\n            id="User_IsUserNameUpdateEnabled"\r\n            name="User.IsUserNameUpdateEnabled"\r\n            class="custom-control-input "\r\n            formControlName="isUserNameUpdateEnabled"\r\n          /><label class="custom-control-label" for="User_IsUserNameUpdateEnabled">{{\r\n            \'AbpIdentity::DisplayName:Abp.Identity.User.IsUserNameUpdateEnabled\' | abpLocalization\r\n          }}</label>\r\n          <small class="form-text text-muted">{{\r\n            \'AbpIdentity::Description:Abp.Identity.User.IsUserNameUpdateEnabled\' | abpLocalization\r\n          }}</small>\r\n        </div>\r\n      </div>\r\n      <hr class="my-4" />\r\n      <div>\r\n        <abp-button\r\n          iconClass="fa fa-save"\r\n          [loading]="loading"\r\n          buttonType="submit"\r\n          [disabled]="form?.invalid"\r\n        >\r\n          {{ \'AbpIdentity::Save\' | abpLocalization }}\r\n        </abp-button>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</form>\r\n',providers:[SubscriptionService]}]}],IdentitySettingsComponent.ctorParameters=()=>[{type:IdentityConfigService},{type:ToasterService},{type:FormBuilder},{type:Store},{type:SubscriptionService},{type:ConfigStateService},{type:ApplicationConfigurationService}];