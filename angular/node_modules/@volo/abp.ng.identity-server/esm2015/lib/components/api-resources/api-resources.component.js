import{ListService}from"@abp/ng.core";import{Confirmation,ConfirmationService}from"@abp/ng.theme.shared";import{EXTENSIONS_IDENTIFIER,FormPropData,generateFormFromProps}from"@abp/ng.theme.shared/extensions";import{Component,Injector}from"@angular/core";import{FormBuilder,Validators}from"@angular/forms";import{take,filter,switchMap}from"rxjs/operators";import{ApiResourcesService}from"../../proxy/api-resources.service";const ɵ0="IdentityServer.ApiResourcesComponent";export class ApiResourcesComponent{constructor(e,r,i,t,s){this.list=e,this.service=r,this.confirmationService=i,this.fb=t,this.injector=s,this.createModalVisible=!1,this.editModalVisible=!1}ngOnInit(){}onAdd(){this.newScopeForm=this.fb.group({name:["",[Validators.required]],displayName:[""],description:[""],allowedAccessTokenSigningAlgorithms:[""],showInDiscoveryDocument:[!1]}),this.createModalVisible=!0}onEdit(e){this.service.get(e).pipe(take(1)).subscribe(e=>{this.editSelectedRecord=e,this.editProperties=e.properties,this.editSecrets=e.secrets;const r=new FormPropData(this.injector,e);this.editScopeForm=generateFormFromProps(r),this.editScopeForm.patchValue({scopes:e.scopes.map(e=>e.scope)}),this.editClaims=e.userClaims.map(e=>({id:e.apiResourceId,name:e.type,left:!0})),this.editModalVisible=!0})}create(e){this.service.create(e).pipe(take(1)).subscribe(e=>{this.createModalVisible=!1,this.list.get()})}edit(e){const r=Object.assign(Object.assign({},e),{scopes:e.scopes.map(e=>({scope:e}))});this.service.update(this.editSelectedRecord.id,r).pipe(take(1)).subscribe(e=>{this.editModalVisible=!1,this.list.get()})}delete(e,r){this.confirmationService.warn("AbpIdentityServer::ApiResourcesDeletionWarningMessage","AbpIdentityServer::AreYouSure",{messageLocalizationParams:[r]}).pipe(filter(e=>e===Confirmation.Status.confirm),switchMap(r=>this.service.delete(e)),take(1)).subscribe(e=>{this.list.get()})}}ApiResourcesComponent.decorators=[{type:Component,args:[{selector:"abp-api-resources",template:'<abp-identity-server-entity-base\r\n  [list]="list"\r\n  [service]="service"\r\n  entityName="ApiResources"\r\n></abp-identity-server-entity-base>\r\n\r\n<abp-identity-server-modal\r\n  *ngIf="createModalVisible"\r\n  [(visible)]="createModalVisible"\r\n  (save)="create($event)"\r\n>\r\n  <abp-identity-server-modal-info-tab [form]="newScopeForm"></abp-identity-server-modal-info-tab>\r\n  <abp-identity-server-modal-claims-tab></abp-identity-server-modal-claims-tab>\r\n</abp-identity-server-modal>\r\n\r\n<abp-identity-server-modal\r\n  *ngIf="editModalVisible"\r\n  [(visible)]="editModalVisible"\r\n  (save)="edit($event)"\r\n  type="Edit"\r\n>\r\n  <abp-identity-server-modal-info-tab\r\n    [form]="editScopeForm"\r\n    [selectedRecord]="editSelectedRecord"\r\n  ></abp-identity-server-modal-info-tab>\r\n  <abp-identity-server-modal-claims-tab\r\n    [claims]="editClaims"\r\n  ></abp-identity-server-modal-claims-tab>\r\n  <abp-identity-server-modal-secrets-tab\r\n    [selectedSecrets]="editSecrets"\r\n  ></abp-identity-server-modal-secrets-tab>\r\n  <abp-identity-server-modal-properties-tab\r\n    [selectedProperties]="editProperties"\r\n  ></abp-identity-server-modal-properties-tab>\r\n</abp-identity-server-modal>\r\n',providers:[ListService,{provide:EXTENSIONS_IDENTIFIER,useValue:ɵ0}]}]}],ApiResourcesComponent.ctorParameters=()=>[{type:ListService},{type:ApiResourcesService},{type:ConfirmationService},{type:FormBuilder},{type:Injector}];export{ɵ0};