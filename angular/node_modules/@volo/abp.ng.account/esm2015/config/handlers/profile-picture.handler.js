import{ConfigStateService}from"@abp/ng.core";import{Injectable,Injector}from"@angular/core";import{PROFILE_PICTURE}from"@volo/abp.commercial.ng.ui";import{filter,map,switchMap,tap}from"rxjs/operators";import{DEFAULT_PROFILE_ICON}from"../constants";import{ProfilePictureService}from"../services/profile-picture.service";import*as i0 from"@angular/core";import*as i1 from"../services/profile-picture.service";import*as i2 from"@abp/ng.core";export class ProfilePictureHandler{constructor(e,r,i){this.profilePictureService=e,this.injector=r,this.configState=i,this.listenToAppConfig()}listenToAppConfig(){const e=this.injector.get(PROFILE_PICTURE);this.configState.createOnUpdateStream(e=>e).pipe(map(()=>this.configState.getDeep("currentUser.id")),filter(e=>e!==this.currentUserId),tap(r=>{this.currentUserId=r,r||e.next(null)}),filter(e=>!!e),switchMap(e=>this.profilePictureService.getProfilePicture(e,!0))).subscribe(r=>{e.next({type:"image",source:r.source||`data:image/png;base64,${r.fileContent}`})},()=>{e.next(DEFAULT_PROFILE_ICON)})}}ProfilePictureHandler.ɵprov=i0.ɵɵdefineInjectable({factory:function(){return new ProfilePictureHandler(i0.ɵɵinject(i1.ProfilePictureService),i0.ɵɵinject(i0.INJECTOR),i0.ɵɵinject(i2.ConfigStateService))},token:ProfilePictureHandler,providedIn:"root"}),ProfilePictureHandler.decorators=[{type:Injectable,args:[{providedIn:"root"}]}],ProfilePictureHandler.ctorParameters=()=>[{type:ProfilePictureService},{type:Injector},{type:ConfigStateService}];